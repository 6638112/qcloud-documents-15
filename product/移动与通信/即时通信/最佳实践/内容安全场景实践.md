即时通信 IM 支持内容审核（反垃圾信息）功能，可针对不安全、不适宜的内容进行自动识别、处理，为您的产品体验和业务安全保驾护航。已支持以下三种内容审核方式：

- 本地审核功能：在客户端本地检测由即时通信 SDK 发送的文本内容，支持对已配置的敏感词进行拦截或者替换处理。此功能通过在 IM 开启服务并配置词库的方式实现。
- 内容回调服务：在服务端检测由单聊、群聊、资料场景中产生的文本、图片、音视频内容，支持对审核模型识别出的不安全内容进行拦截。此功能通过在 IM 内容回调配置处填入 [腾讯云内容安全产品](https://cloud.tencent.com/document/product/1124/80221) 策略信息实现。
- 第三方回调服务：如果您已接入第三方内容审核服务，您可以使用 [第三方回调配置](https://cloud.tencent.com/document/product/269/1632) 来实现。 

## 本地审核功能

本地审核功能，全称“客户端本地文本审核”，通过在客户端本地完成敏感词的拦截或者替换，实现过滤敏感词的效果。可用于拦截/替换在发送文本消息、修改昵称/备注/群公告等操作中产生的、不希望被发送的文本敏感词。

> ! 该功能仅支持终端 SDK 增强版 6.8 、Web SDK 2.24.0 及以上版本。

本地审核仅对文本内容进行检测，支持如下场景：

- 单聊文本消息：在双人聊天场景下通过 IMSDK 发送的文本消息
- 单聊自定义消息：在双人聊天场景下通过 IMSDK 发送的自定义消息
- 群聊文本消息：在群组（包括好友工作群 Work、陌生人社交群 Public、临时会议群 Meeting、直播群 AVChatRoom、社群 Community）聊天场景下通过 IMSDK 发送的文本消息
- 群聊自定义消息：在群组（包括好友工作群 Work、陌生人社交群 Public、临时会议群 Meeting、直播群 AVChatRoom、社群 Community）聊天场景下通过 IMSDK 发送的自定义消息
- 资料文本内容：对用户资料（包含昵称、个性签名、自定义状态字段）、关系链资料（包含加好友附言字段）、群成员资料（包含群成员名片字段）、群组资料（群名称、群简介、群公告、加群附言、话题名称、话题公告、话题简介字段）进行修改所产生的文本内容

本地审核词库是由开发者在控制台配置的，分为拦截词库和替换词库，支持关键词和正则表达式两种检测方式，IMSDK 在登录后会自动获取词库。
IMSDK 在发送文本内容时，如果文本内容命中了拦截词库的敏感词，则该文本不会发送至服务端；如果命中了替换词库的敏感词，则会把文本中的敏感词替换成控制台配置的指定字符再发送至服务端。

### 接入流程

#### 步骤1：开通本地审核功能

在前往即时通信 IM [购买页](https://buy.cloud.tencent.com/avc?activeId=safe&regionId=1)，购买后即刻生效。体验版、专业版、旗舰版套餐包均可购买本地审核服务。
![](https://qcloudimg.tencent-cloud.cn/raw/aed5d0d24cbc977040de062e0d60e8e9.png)

#### 步骤2：配置词库

开通本地审核功能后，请在控制台进行词库配置。

> !词库分为拦截词词库和替换词词库，两个词库总上限10000词，其中正则表达式不超过200个。

1. **添加拦截词词条**：单击 **添加拦截词** 后，选择需要添加的**词条格式**。
![](https://qcloudimg.tencent-cloud.cn/raw/bce6e8d53fde12678ac00b57591d7295.png)
**关键词**格式的词条，可以通过**手动输入**或者**文件上传**的方式添加。手动输入，单次最多添加50个词；文件上传仅支持 .txt 格式的文本，不限制单次添加个数，但添加词条总数应小于词库上限，否则添加失败。
**正则表达式**格式的词条，仅支持**手动输入**。
> !因正则表达式对性能影响较高，请您务必在添加正则表达式前进行耗时测试，避免影响您业务可用性。
> 
![](https://qcloudimg.tencent-cloud.cn/raw/30c4bc3d9a69c000795b89996e5711ff.png)
2. **添加替换词词条**：单击 **添加替换词** 后，选择需要添加的**词条格式**。
![](https://qcloudimg.tencent-cloud.cn/raw/ecf7de7a6e5d9cbb056a6c31f3be2ea4.png)
**关键词**格式的词条，可以通过**手动输入**或者**文件上传**的方式添加。手动输入，单次最多添加50个词；文件上传仅支持 .txt 格式的文本，不限制单次添加个数，但添加词条总数应小于词库上限，否则添加失败。**正则表达式**格式的词条，仅支持**手动输入**。
> !因正则表达式对性能影响较高，请您务必在添加正则表达式前进行耗时测试，避免影响您业务可用性。
>同时，输入需要**全部替换为**的内容，默认是“\*”，支持自定义内容。
>
![](https://qcloudimg.tencent-cloud.cn/raw/40b08f8a7746fcf50c2f122d87362665.png)
3. 可根据业务实际需要，**搜索**、**逐个删除**、**批量删除**拦截词词库或者替换词词库中的词条。

#### 步骤3：选择审核场景

默认为您全部勾选审核场景，您可通过单击**编辑**，在审核场景配置弹窗中操作**勾选/取消勾选**并**确定**。
![](https://qcloudimg.tencent-cloud.cn/raw/8a7a95bd990a667645abc2f9b82ec9da.png)
![](https://qcloudimg.tencent-cloud.cn/raw/7e81ca86a76e37bef514229050dfaedc.png)


#### 步骤4：IMSDK 更新词库

词库添加完成之后，IMSDK 需要重新登录才能更新词库。
以发送文本消息为例，当内容中包含拦截词库中的敏感词时，消息发送失败，终端 SDK 回调的错误码为7015，Web SDK 回调的错误码为3123；当内容中包含替换词库中的敏感词时，敏感词会被替换成控制台配置的指定字符，再将替换后的内容发送至服务端。


## 内容回调服务

服务端的内容审核推荐使用即时通信 IM 提供的内容回调，并接入 [腾讯云内容安全产品](https://cloud.tencent.com/document/product/1124/80221)，支持单聊、群聊，设置资料文本内容等场景，可针对图文同步审核，大大缩短了接入流程，无需额外开发，而且延迟更低。

>!
>
>1. 文本同步审核，拦截后会向 SDK 返回80001的错误码，450ms超时。
>2. 图片默认异步审核，拦截后会封禁文件，后续下载不到违规文件，但图片可以配置 URL 时支持同步审核，拦截后会向 SDK 返回80004的错误码，2s超时。
>3. 音视频异步审核，拦截后会封禁文件，后续下载不到违规文件。

![](https://qcloudimg.tencent-cloud.cn/raw/32f8dbf2bc693b5f74f0d59acdc800f7.png)
### 接入流程

#### 步骤1：获取内容回到 URL 和 Token

从 [腾讯云内容安全产品](https://cloud.tencent.com/document/product/1124/80221) 获取内容回调 URL和 Token。

#### 步骤2：配置内容回调

根据您业务诉求，将从 [腾讯云内容安全产品](https://cloud.tencent.com/document/product/1124/80221) 获取的内容回调 URL 和 Token 填写至 [即时通信 IM 控制台](https://console.cloud.tencent.com/im/callback-setting)。

1. 进入 即时通信 IM 控制台 > 回调配置 > [内容回调配置](https://console.cloud.tencent.com/im/callback-setting)，单击页面内模块右上角的“编辑”。
   ![](https://qcloudimg.tencent-cloud.cn/raw/6e90479c58c3b49b655a0ff9bde25b2e.png)
2. 在“编辑”弹窗中，填入从 [腾讯云内容安全产品](https://cloud.tencent.com/document/product/1124/80221) 获取的内容回调 URL 和 Token，并勾选需要生效的回调内容类型，单击**确定**。
   ![](https://qcloudimg.tencent-cloud.cn/raw/c3d8ab169b59821a012b4d48b8ce4a3f.png)
>!同一内容回调 URL 和 Token，可填写至多个 IM 应用的多个内容回调配置模块内。
3. 查看回调配置和已生效回调内容类型/回调字段。
   ![](https://qcloudimg.tencent-cloud.cn/raw/28bbcf67b36e82d0a10f13441685afdd.png)

#### 步骤3：配置内容回调结果

如果您想对“返回内容回调结果”、“下发拦截错误码”做进一步配置，请参见 [内容回调配置文档](https://cloud.tencent.com/document/product/269/32431#.E5.86.85.E5.AE.B9.E5.9B.9E.E8.B0.83.E7.BB.93.E6.9E.9C.E9.85.8D.E7.BD.AE)。

## 第三方回调服务

如果您已经接入了其他第三方内容安全服务，可以通过 IM 服务端提供的 [第三方回调](https://cloud.tencent.com/document/product/269/1632) 来自行实现内容审核，如下图所示，通过第三方回调将内容发送至第三方内容审核服务，后再判断是否投递至接收方
![](https://qcloudimg.tencent-cloud.cn/raw/fde5bc51aa0a7be59ff90529d50d1465.png)

## 交流与反馈

欢迎加入 QQ 群进行技术交流和反馈问题。
<img src="https://qcloudimg.tencent-cloud.cn/raw/e2050d5b5c894c7da725f8e25c5bfe82.jpg" style="zoom:20%;"/>

