## 功能简介
流量调度管理是腾讯云 EdgeOne 提供的多 CDN 智能解析调度工具，支持在源站、多个服务商之间自定义流量调度策略，实现流量平滑灰度迁移和灵活分配，保证服务高可用。

#### 应用场景
- 灰度迁移：引入新服务商时，为了保证服务可用性，需要进行灰度切换，实现业务平滑迁移。
<img src="https://qcloudimg.tencent-cloud.cn/raw/cd45261d354efcb668253415143c2ed5.png" width=600px>
- 多厂商调度：业务量级较大且敏感，为了分散风险，希望将流量灵活分配给多家服务商，实现业务容灾。
<img src="https://qcloudimg.tencent-cloud.cn/raw/04269aeaa74e2f972625e44ecd61ec44.png" width=600px>

#### 功能特点
- 管理简单：选择域名 > 添加服务商 > 添加调度策略，仅需三步加即可实现流量调度管理。
- 快速接入：用户只需在 DNS 解析商处添加 EdgeOne 分配的 CNAME 记录即可实现快速接入。
- 多种调度模式：支持按比例、按区域的调度模式，可组合使用满足多样化需求。
- 覆盖场景多样：支持源站和 CDN 厂商作为调度服务商，可以满足灰度切换和同时使用多家服务商的场景。

## 前提条件
您需要成功 [购买](https://cloud.tencent.com/document/product/1552/70194) 边缘安全加速平台（EdgeOne）产品（企业版），且使用 CNAME 模式完成 [站点接入](https://cloud.tencent.com/document/product/1552/70788)。

## 添加流量调度策略
1. 登录 [边缘安全加速平台控制台](https://console.cloud.tencent.com/edgeone)，在左侧导览中，选择站点后单击**域名服务**，选择**流量调度管理**页面。
<img width="1365" alt="image" src="https://user-images.githubusercontent.com/116173601/204139321-03e2c0fe-9a5f-4267-b7cb-4df3d0f267e9.png">

2. 在流量调度管理页面，单击**添加调度策略**，选择需要开启流量调度的域名，单击**创建**。
<img width="1359" alt="image" src="https://user-images.githubusercontent.com/116173601/204139597-654fa7d9-b784-4999-9bad-880f633a9c66.png">

3. 单击**添加服务商**，按照业务需求配置服务商名称、CNAME等参数，单击**下一步**。
>?提供默认服务商 EdgeOne，不可修改和删除。支持新增源站域名和其他 CDN 服务商 CNAME 域名。

a.从源站灰度迁移至EO场景配置参考：
服务商需要增加源站域名，可定义个名称和输入源站域名：
<img width="1153" alt="image" src="https://user-images.githubusercontent.com/116173601/204138663-dcd17898-5484-4f44-8db6-47e5f143f6f0.png">

b.多厂家共同服务场景配置参考：：
比如同时要选择EdgeOne,CDN厂商A和CDN厂商B共同服务，则可以再分别添加两家CDN厂商名称以及对应调度CNAME域名：
<img width="1165" alt="image" src="https://user-images.githubusercontent.com/116173601/204138384-4ade4f8e-ccca-42c3-bd52-ab5d0b9b0a24.png">


4. 单击**添加策略**，选择线路/区域，配置多服务商的调度策略，服务商支持多选以及权重设置，完成后单击**提交配置**。
>?
>- 默认策略为全部流量走 EdgeOne，该策略作为兜底策略不可删除，可支持修改为其他服务商。
>- 线路/区域支持国家地区，中国大陆运营商、省份、省份运营商，美国各洲和印度各邦。
>- 细粒度区域/线路生效优先级更高，如配置北京调度源站、中国大陆调度服务商 A 、默认线路调度服务商 B，则北京地区走源站，中国大陆其他区域走服务商 A，境外区域走服务商 B。
>

a.从源站灰度迁移至EO场景配置参考：
假定先将1%流量从源站切换到EdgeOne，服务一段时间后可以考虑修改为10%切到EdgeOne，按切换计划逐步修改比例。
可以先设定如下，执行完本阶段5个步奏，运行成功后，在后续点击管理可以点击修改比例，如10%。
<img width="1155" alt="image" src="https://user-images.githubusercontent.com/116173601/204138748-21565ddb-4c56-42d9-b4a9-850c8227edd7.png">
b.多厂家共同服务场景配置参考：
假定中国大陆区域使用EdgeOne服务，新加坡地区60%使用EdgeOne服务，40%使用CDN厂商B服务，其他区域采用CDN厂商A服务。
<img width="1105" alt="image" src="https://user-images.githubusercontent.com/116173601/204139095-d592404f-f0f5-4147-a358-42e74732c79d.png">

5. 添加策略完成后，因流量调度CNAME和域名默认CNAME一致，如果域名解析已切换，则无需变更，策略立即生效现网；否则，需要在 DNS 服务商处完成域名解析切换，方可触发流量调度策略生效。
<img width="1353" alt="image" src="https://user-images.githubusercontent.com/116173601/204139712-a3385933-30d6-4df7-8fe1-a1fb52d90208.png">



## 管理流量调度策略
在 [域名服务](https://console.cloud.tencent.com/edgeone/dns) > **流量调度管理**页面，可以编辑管理、停用、启用和删除策略。
### 停用策略
停用策略会导致流量调度策略失效，所有流量将全部调度使用 EdgeOne 进行服务。
### 启用策略
停用的策略可通过启用恢复使用流量调度管理，启用后流量会从全部调度使用 EdgeOne 变更为按配置的策略进行调度。
### 删除策略
停用策略后，可删除策略，删除不影响服务，但策略不可恢复，请谨慎操作。 
### 管理策略
单击**管理**可以进入**调度策略管理**页面，可以对服务商和调度策略进行增加、删除、修改以及停用。
>?
>- 变更已被策略引用的服务商，保存后会立即生效到策略。
>- 删除和修改策略、启用和停用策略均会立即生效。
>- 已被策略引用的服务商，无法删除。
>
![](https://qcloudimg.tencent-cloud.cn/raw/d45f86def9d128bf18add56bd7128fec.png)
